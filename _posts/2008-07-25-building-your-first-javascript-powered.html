---
layout: post
title: Building your first Javascript-powered Symbian application using Webkit
date: '2008-07-25T23:12:00.002+02:00'
author: Hossam Hammady
tags:
- symbian
- javascript
modified_time: '2008-10-04T16:56:57.018+02:00'
blogger_id: tag:blogger.com,1999:blog-1427064072400819258.post-7712767689451252001
blogger_orig_url: http://blog.hammady.net/2008/07/building-your-first-javascript-powered.html
---

<p>The 10-years old <a href="http://www.symbian.com/" class="external text" title="http://www.symbian.com/">Symbian OS</a> is the open mobile operating system, that powers millions of smartphone worldwide, especially <a href="http://www.nokia.com/" class="external text" title="http://www.nokia.com/">Nokia</a> mobile phones.<br />Symbian itself is the OS engine that is customized by device manufacturers to produce real operating systems. Symbian has 3 platforms, the S60 which runs mostly on Nokia phones, the UIQ which runs mostly on <a href="http://www.sonyericsson.com/" class="external text" title="http://www.sonyericsson.com/">Sony Ericsson</a> and <a href="http://www.motorola.com/" class="external text" title="http://www.motorola.com/">Motorola</a>, and the MOAP (new).<br /></p><p>Developing for Symbian is an inevitable task for developers targeting mobile platforms. Depending on the target platform, a developer should select a Symbian SDK to use. The S60 platform itself contains a lot of versions with a corresponding SDK for each version. 1st, 2nd and 3rd editions exist, each one having as many as 3 to 4 feature packs. This results in about 9 versions. 1st edition represents Symbian OS v6.1 and the latest is v9.5. <a href="http://developer.symbian.com/main/index.jsp" class="external text" title="http://developer.symbian.com/main/index.jsp">The Symbian Developer Network (SDN)</a> and <a href="http://www.forum.nokia.com/" class="external text" title="http://www.forum.nokia.com/">Forum Nokia</a> has been always Sybmian developers heaven.<br /></p><p>Symbian applications are written in C++ (native) or Java (requires J2ME). The Internet browsing on Symbian started with <a href="http://www.opera.com/" class="external text" title="http://www.opera.com/">Opera</a> in its first releases. However, after releasing <a href="http://webkit.org/" class="external text" title="http://webkit.org/">Webkit</a> as an open-source project, it has been adopted by Symbian starting from 3rd edition as its default browser engine.<br /></p><p>The good news is that you can develop your own Symbian application that links with the Webkit and exploits its capabilities in Javascript interpretation and DOM manipulation. The bad news is that there is no guide, up to my knowledge, that demonstrates this!<br /></p><p>So here are simple steps for creating your first Javascript-enabled S60 application:<br /></p><br /><span class="fullpost"><br /><ul><li> First of all, download and build S60Webkit using <a href="http://wiki.forum.nokia.com/index.php/Building_S60Webkit#Configure_Your_Computer" class="external text" title="http://wiki.forum.nokia.com/index.php/Building_S60Webkit#Configure_Your_Computer">this guide</a>. Don't panic for build errors, you will find all solutions in this guide. This should work for Carbide.c++ the latest release v1.3. You will need also <a href="http://symbiangeek.blogspot.com/2008/02/change-details-compiling-s60webkit-with.html" class="external text" title="http://symbiangeek.blogspot.com/2008/02/change-details-compiling-s60webkit-with.html">this guide</a> because Carbide v1.0 is obsolete. Remember 3 simple rules:<br /><ul><li> to build for the emulator use "build -w"<br /></li><li> to build for the device use "build -g"<br /></li><li> to build a special target use "build -? targetname"<br /></li></ul><br /></li><li> There is a bug in the Perl script that scans build output to show number of errors/warnings. Find the file in: C:\Symbian\9.1\S60_3rd\Epoc32\tools\scanlog.pm, or change path to your SDK installation path. To fix it, find the condition following the comment:<br /></li></ul><code></code># make: *** [SAVESPACECONVTOOL] Error 2<br /><br /><p>with<br /></p><p><code>if ($line =~ /make(\[\d+\])?:\s*\*\*\*.*(E|e)rror/)<br /></code><br /></p>Start a new project in Carbide.c++ IDE using File-&gt;New-&gt;Symbian OS C++ project and select 3rd-Future ed. GUI application. Follow on-screen steps and you now have a simple HelloWorld application.<br /><ul><li> Now its time to link with the Webkit. You will have to edit some header and configuration files to get it working:<br /><ul><li> modify S60/JavaScriptCore/kjs/list.h and add<br /></li></ul><br /></li></ul><pre>#if NOKIA_CHANGES<br />#include &lt;oom.h&gt;<br />#endif<br /></pre><p>somewhere in the beginning of the file<br /></p><ul><li> Edit the project mmp file (&lt;projectname&gt;.mmp) using Carbide IDE visual editor:<br /><ul><li> In the libraries tab at the bottom click on Add to add 2 libraries: JavaScriptCore_sdk.lib and MemMan_sdk.lib. If you did not find either then the building of S60Webkit was incomplete.<br /></li><li> In the options tab add 4 entries in the Compiler Settings area:<br /><ul><li> User includes: /Symbian/9.1/S60_3rd/s60/JavaScriptCore/kjs<br /></li><li> System includes: /Symbian/9.1/S60_3rd/s60/MemoryManager/Inc and /epoc32/include/libc<br /></li><li> Macros: NOKIA_CHANGES<br /></li></ul><br /></li></ul><br /></li><li> Edit the file where you want to write webkit-specific code, for example: xxxxAppUI.cpp:<br /><ul><li> Include the interpreter header file:<br /></li></ul><br /></li></ul>#include "interpreter.h"<br /><br /><ul><li><ul><li> write some code for Javascript interpretation, for example in the handler for first menu action:<br /></li></ul><br /></li></ul><p><code>   using namespace KJS;<br /></code></p><p>   InterpreterLock lock;<br /></p><p><br /><br />   Object globalObj(new ObjectImp);<br /></p><p>   Interpreter *interp = new Interpreter(globalObj);<br /></p><p>   UString code = KJS::UString("10 * 5");<br /></p><p>   Completion result = interp-&gt;evaluate(code);<br /></p><p>   ComplType resultType = result.complType();<br /></p><p>   if (resultType == Normal) {<br /></p><p>    // OK<br /></p><p>    textResource = StringLoader::LoadLC(R_MESSAGE_OK);<br /></p><p>    // textResource loaded with StringLoader.<br /></p><p>    informationNote-&gt;ExecuteLD( *textResource);<br /></p><p>    // Pop HBuf from CleanUpStack and Destroy it.<br />    CleanupStack::PopAndDestroy(textResource);   <br /></p><p>   }<br /></p><p>   else {<br /></p><p>    // failure<br /></p><p>    textResource = StringLoader::LoadLC(R_MESSAGE_FAILURE);<br /></p><p>    // textResource loaded with StringLoader.<br /></p><p>    informationNote-&gt;ExecuteLD( *textResource);<br /></p><p>    // Pop HBuf from CleanUpStack and Destroy it.<br />    CleanupStack::PopAndDestroy(textResource);   <br /></p><p>   }<br /><br />You may replace the variable "code" with any valid Javascript code.<br /></p><br /><ul><li><ul><li> add some string resources for the previous code to compile. In file data/&lt;projectname&gt;.rls add these 2 lines:<br /></li></ul><br /></li></ul><br /><br /><pre>#define qtn_message_ok "OK"<br />#define qtn_message_failure "Failure"<br /></pre><br /><ul><li><ul><li> In file data/&lt;projectname&gt;.rss add:<br /></li></ul><br /></li></ul><p><code><br />RESOURCE TBUF r_message_ok { buf=qtn_message_ok; }<br /></code></p><p>RESOURCE TBUF r_message_failure { buf=qtn_message_failure; }<br /><br /></p><br /><ul><li> Build your project for the emulator<br /></li><li> Open the emulator from Start menu and browse to Installed-&gt;&lt;projectname&gt;<br /></li></ul><br /><p>Your application sould open, press the left menu button to show the menu, then select Message and get your previous Javascript evaluated by seeing 'OK'!<br /></p><p>I hope I have covered all dark parts, in case something was missing, please comment here to augment any missing part.<br /></p><div class="fivestar-static-form-item"><div class="form-item"><br /><br /></div></div><br /></span>