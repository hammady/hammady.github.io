---
layout: post
title: Getting your location using iPhone with no GPS
date: '2009-09-05T16:41:00.000+02:00'
author: Hossam Hammady
tags:
- iphone
modified_time: '2009-09-05T15:53:06.395+02:00'
blogger_id: tag:blogger.com,1999:blog-1427064072400819258.post-2761280543750345342
blogger_orig_url: http://blog.hammady.net/2008/11/getting-your-location-with-iphone-with.html
---

One of the main big features in iPhone 3G that was not shipped with its ancestor iPhone 2G is GPS support. You can determine your location using GPS satellites.<br />It is known that although very accurate, GPS has some drawbacks. It needs a lot of time to connect to the satellites, in the order of tens of seconds. It won't work indoors as well. Moreover, it is <a href="http://www.cellular-news.com/story/34085.php">banned</a> in Egypt, Syria and North Korea!<br />Update: It is <a href="http://rescommunis.wordpress.com/2009/04/20/egypt-lifts-gps-ban/">not banned</a> anymore in Egypt.<br /><br />So can one determine his location without the aid of GPS technology? The answer is Yes. This can be done by identifying nearby GSM cell towers and query a database that stores their location. So lets divide the rest of this post into 2 parts:<br /><span class="fullpost"><br /><br /><span style="font-size:130%;">Identifying nearby GSM cell towers</span><br /><br />Doing this on the iPhone was a bit tricky. Actually it was a challenge for us at <a href="http://www.espace.com.eg/">eSpace</a> to get such information. I will list here the challenges we met and how we managed to solve them:<br /><ol><li>There is no official SDK for iPhone OS 1.x. This was the easiest challenge to solve. Everybody uses <a href="http://code.google.com/p/iphone-dev/wiki/Building">iphone-dev</a> for building the iPhone toolchain. Most of the header files in the toolchain are generated by <a href="http://www.codethecode.com/projects/class-dump/">class-dump</a>! This is a tool that takes a binary framework (library) as an input and emits some Objective-C code in a header file that represents symbols in the library. Its idea is as simple as using <a href="http://linux.about.com/library/cmd/blcmdl1_nm.htm">nm</a> to query symbol names and some extra code to wrap this info in Objective-C syntax.<br /></li><li>Even in the non-official toolchain, there is not a word on how to deal with telephony features like calls and text messaging. Thanks to <a href="http://code.google.com/p/iphone-wireless/source/browse/#svn/trunk/CellStumbler">CellStumbler</a>, we used it to get cell information. It is a tool that exploits CoreTelephony framework functionality. CoreTelephony.h is also generated with class-dump.</li><li>CellStumbler is very fragile, if you do simple edits in it, it may crash! The guys say it is toolchain bugs! Just keep this in mind if you need to modify it. Be aware that server connection callback never get called, so keep on retrieving cell information until you get something useful.</li><li>Because CellStumbler is that fragile, we left the code untouched in its major parts, we just changed the part that outputs results. We then called the binary from a shell and parsed its output to get useful nearby cell information.<br /></li></ol><br /><span style="font-size:130%;">Querying a database for cell location</span><br /><br />Google used to have a secret API for this. It is called My Location. This is the API it uses in Maps. Unfortunately, at the time of our development, the API was secret, we had to sniff upon packets to/from Google Maps to know what happens under the hood and replays it. Now this API is <a href="http://googlemobile.blogspot.com/2008/06/google-enables-location-aware.html">open to developers</a>, thanks Google.<br /><br /></span>