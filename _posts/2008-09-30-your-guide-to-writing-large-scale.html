---
layout: post
title: Your Guide to Writing Large-Scale Javascript Applications
date: '2008-09-30T02:33:00.007+02:00'
author: Hossam Hammady
tags:
- javascript
modified_time: '2008-10-04T16:55:24.912+02:00'
blogger_id: tag:blogger.com,1999:blog-1427064072400819258.post-575277394202390036
blogger_orig_url: http://blog.hammady.net/2008/09/your-guide-to-writing-large-scale.html
---

<span style="font-size:85%;">What is peculiar in Javascript is that it is designed for many types of applications. Noobs can learn it in minutes. They can just go write little validation code insided web pages. Advanced web applications also rely heavily on Javascript. It is even taken beyond the web paradigm. Now you can find Javascript running on servers, inside desktop applications, and even on hand-held devices.<br /><br />This explains the ongoing war between Javascript interpreters, <a href="http://code.google.com/p/v8/">V8</a>, <a href="http://webkit.org/blog/189/announcing-squirrelfish/">SquirrelFish</a>  (and <a href="http://webkit.org/blog/214/introducing-squirrelfish-extreme/">SquirrelFish Extreme</a>) and <a href="https://wiki.mozilla.org/JavaScript:TraceMonkey">TraceMonkey</a>. Each engine fights to dominate the market. Actually this is so important as web applications are becoming a lot more complex and old-style Javascript engines are dying out of performance. Embedded devices also need performant Javascript engines due to their limited resources.<br /><br />When your Javascript application grows in size, you will find it very difficult to maintain because the language is designed to be written in a simple way, no enforcements or conventions of any type. Actually, you will most probably end up with a very bad code. To avoid this and to write neat, maintainble and scalable Javascript applications, I have brainstormed with myself and wrote down the following guidelines. Some of them are general and can be applied to any programming language, not necessarily Javascript. I will be constantly adding to these guidelines as I forumalate them.<br /><br /></span><br /><span class="fullpost"><br /><ol><li><span style="font-size:85%;"><span style="font-weight: bold;font-size:130%;" >Use classes instead of separate global functions. </span><br />One may simply write an old C-style program around functions. The good, although old, news is that Javascript can be written in an object-oriented (OO) style. Although there are no explicit class definitions or inheritance, you still can work around this and define your own classes with both public and private access to data members and member functions. As implied by the OO design, your application will neatly grow as it goes. I will not discuss how to write classes but you can see the <a href="http://downloads.hammady.net/jsexamples/jiggy/">these examples</a> and see these useful links (<a href="http://www.xml.com/pub/a/2006/06/07/object-oriented-javascript.html">1</a> and <a href="http://www.developertutorials.com/tutorials/javascript/writing-classes-in-javascript-050404/page1.html">2</a> or google it).</span></li><li><span style="font-size:85%;"><span style="font-weight: bold;font-size:130%;" >Don't pollute the global context, always use namespaces/singletons.</span><br />If you strictly followed the previous point of the OO design, you will end up with a lot of class names. These class names are nothing but global variables, we approach the start point again. You can create namespaces to hold class definitions inside. For example:<br /></span></li><span style="font-size:85%;"><code>var MyPackage = {<br />MyClassA: function() {...},<br />MyClassB: function() {...}<br />}<br /></code><br />This way, we have just hidden MyClassA and MyClassB inside MyPackage namespace. To instanciate objects we write:<br /><code><br />x = new MyPackage.MyClassA().<br /></code><br />Note also that similarly we can write a singleton class:<br /><code><br />var MySingleton = {<br />method1: function() {...},<br />method2: function() {...},<br />variable1: 10,<br />variable2: "hello"<br />}<br /></code><br />You access singleton members as:<br /><code><br />MySingleton.method1()<br />MySingleton.variable1<br /></code><br />and so on.<br /></span><li style="font-weight: bold;"><span style="font-size:130%;">Make your functions anonymous and give them variable names.</span></li><span style="font-size:85%;">Functions in Javascript may be anonymous as well as named. For example you can define a function like this:<br /><code><br />function myfunc() {...}<br /></code><br />You can also write:<br /><code><br />function() {...}<br /></code><br />The latter form can be used as a closure or as an inline function. See <a href="http://www.jibbering.com/faq/faq_notes/closures.html#clClose">this</a>, <a href="http://blog.morrisjohns.com/javascript_closures_for_dummies">this</a> and <a href="http://developer.mozilla.org/en/Core_JavaScript_1.5_Guide/Working_with_Closures">that</a> for more information about closures.<br />Being an inline function you can set it to a variable:<br /><code><br />var myfunc = function() {...}<br /></code><br />This form may seem equivalent to the named form example above. However, they are not always equivalent. It is interpreter-specific. In IE JScript (I think it was IE6), named functions are always given their name regardless of their scope. This has the side effect of defining the function name as a global variable name. Take this example for more clarification:<br /><code><br />if (a > 1)<br />function foo() {...}<br /></code><br />In bad interpreters (Micro$oft JScript for example) foo is always a global variable of type function. It can be called in all cases not only if a > 1!<br />Need a dangerous scenario? Take this example:<br /><code><br />if (typeof foo == 'undefined')<br />function foo() {...}<br /></code><br />Suppose you need to check whether a function is defined or not, and if not define it your own way. This could happen inside a large application where you test if some sources are included and act accordingly. This will not work as expected due to the missbehavior of such interpreter. I faced this problem when writing some code that checks if <a href="http://www.prototypejs.org/">prototype</a> was included or not. So I wrote:<br /><code><br />if (typeof $ == 'undefined')<br />function $(element) {return document.getElementById(element)}<br /></code><br />The result was my $ always overriding prototype's $!<br />The solution is easy, just use:<br /><code><br />if (typeof $ == 'undefined')<br />var $ = function (element) {return document.getElementById(element)}<br /></code><br />This way, $ will not be defined unless it is already defined before.<br /><br /></span><li style="font-weight: bold;"><span style="font-size:130%;">Keep your files small, don't worry about number of files.</span></li><span style="font-size:85%;">As a general practice, don't place more than 1 class definition in a file. Consider Java public classes where you cannot define more than 1 public class in a file and file name should be the same as that public class. If this has changed in current specification, please tell me as I am not an active Java developer. This will add to modularity and will make your classes more liable to reusability.<br /><br /></span><li style="font-weight: bold;"><span style="font-size:130%;">Never use alerts for debugging.</span></li><span style="font-size:85%;">Debugging Javascript code using alerts always proves to be not practical. It pauses execution until the user dismisses the alert. You cannot just put 10 alerts and have them displayed each run waiting for you to dismiss them! Sometimes it is invalid to log through alerts. Suppose you need to simulate real time performance while you are having multiple threads, for AJAX requests as an example. Alerts will ruin the synchronization of threads because they pause their owning threads. Its worth noting that text inside alerts are limited to the display area.<br /><br /></span><li style="font-weight: bold;"><span style="font-size:130%;">Always use log messages for debugging.</span></li><span style="font-size:85%;">A better solution for debugging, still not the best, is using log messages rather than alerts. Logging debug information has many benifits of not blocking the running thread, playing the 10 messages with no code interruption and simulating the real time performance of threads. If you are inside a web page, you can log to some text area by modifying its value property. In <a href="http://www.jiggyapp.com/">Jiggy</a>, you can use the global function log() to throw away any message to the console. It is important to note that logging is not only for debugging. You have to log your application activity for inspection afterwards. This may help you enhance its performance or monitor user activity.<br /><br /></span><li style="font-weight: bold;"><span style="font-size:130%;">Consider using dynamic log-levels when your logs become bloated.</span></li><span style="font-size:85%;">Following the logging paradigm will render your log stream unreadable. When you add a new log line it will not be noticed among tens and hundreds of other log lines. Thinking of disabling older log lines is not the best solution, you may need to come back and debug something old. By enabling/disabling log lines you will be uncommenting/commenting some code. As a general practice code inside comments is highly discouraged. Actually you will need to debug several aspects continuously, like requests sent/received on network. Thats why log levels are for. However, I don't mean here the basic 4 levels that are widely used: Error, Warning, Info and Debug. These levels are placed according to severity of log. What I mean here is dynamically creating log levels according to different aspects of your application logic. For example, you may have aspects called "Network", "Database", "Rendering", "Flow" and such. Lets call them log aspects as opposed to log levels. When you log any message you define its aspect from these aspects. You may also combine an aspect with one of the 4 basic log levels mentioned above. When you wish to debug warnings from the network aspects you enable Warning level and Network aspect from a central configuration file. Such file may turn on and off all aspects and levels for your application. For example:<br /><code><br />var ENABLE_LOGS = true<br />var DEBUG_ASPECT_NETWORK = true<br />var DEBUG_ASPECT_DATABASE = false<br />...<br />var DEBUG_LEVEL_ERROR = false<br />var DEBUG_LEVEL_WARN = true<br />...<br /></code><br />and in your log lines:<br /><code><br />LOG("message here", DEBUG_ASPECT_NETWORK &amp;&amp; DEBUG_LEVEL_WARN)<br /></code><br />where LOG is simply defined as:<br /><code><br />var LOG = function(message, enabled)<br />{<br />if (ENABLE_LOGS &amp;&amp; enabled) log(message)<br />}<br /></code><br />You can add debug aspects and levels dynamically as your application grows. You can enable/disable aspects and levels as required without commenting/uncommenting your code.<br /><span style="font-size:130%;"><br /></span></span><li><span style="font-size:85%;"><span style="font-size:130%;"><span style="font-weight: bold;">If you are working inside a web browser, consider a Javascript debugger.</span></span> For Firefox there is <a href="http://www.mozilla.org/projects/venkman/">Venkman</a> and <a href="http://getfirebug.com/">Firebug.</a></span><span style="font-size:85%;"> If your log mechanism didn't help you, you may consider a real debugger which steps you into your code and helps you inspecting variables.<br /></span></li></ol><span style="font-size:85%;">Thats all for now, stay tuned for a more focused post about writing large-scale Jiggy applications!<br /><br /></span><br /><br /></span>